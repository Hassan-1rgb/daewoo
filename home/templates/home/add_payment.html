{% extends "home/base.html" %}
{% load static %}

{% block title %}Add Payment / Reservation{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card shadow-lg border-0 rounded-3">
                <div class="card-header bg-primary text-white text-center">
                    <h4 class="mb-0">Add Payment / Reservation</h4>
                </div>
                <div class="card-body p-4">
                    <h5 class="text-center mb-3">
                        Booking <span class="text-primary">{{ booking.booking_number }}</span>
                    </h5>

                    <form method="post" novalidate>
                        {% csrf_token %}

                        <!-- Amount -->
                        <div class="mb-3">
                            <label class="form-label">Amount</label>
                            <input type="number" step="0.01" class="form-control" 
                                   value="{{ total_price }}" readonly>
                        </div>

                        <!-- Action Type -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Choose Action</label>
                            <select class="form-select" name="action_type" id="action-type" required>
                                <option value="">-- Select Option --</option>
                                <option value="reserve">Reserve (Pay Later)</option>
                                <option value="pay">Make Payment</option>
                            </select>
                        </div>

                        <!-- Reserve Section -->
                        <div id="reserve-section" class="d-none">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                Your seat will be reserved for 30 minutes. You will receive an email with the details.
                            </div>
                            <button type="submit" class="btn btn-warning w-100" name="action_type" value="reserve">
                                <i class="bi bi-clock-history"></i> Reserve Seat
                            </button>
                        </div>

                        <!-- Payment Section -->
                        <div id="payment-section" class="d-none">
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Payment Method</label>
                                <select class="form-select" name="method" id="payment-method">
                                    <option value="">-- Select Method --</option>
                                    <option value="cash">Cash</option>
                                    <option value="card">Credit/Debit Card</option>
                                    <option value="wallet">Wallet</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                </select>
                            </div>

                            <!-- Card Payment Info -->
                            <div id="card-info" class="d-none">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Card Number</label>
                                    <input type="text" class="form-control" name="card_number" maxlength="16" placeholder="1234 5678 9012 3456">
                                </div>
                                <div class="mb-3 row">
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">Expiry Date</label>
                                        <input type="text" class="form-control" name="expiry_date" placeholder="MM/YY">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">CVV</label>
                                        <input type="password" class="form-control" name="cvv" maxlength="4" placeholder="123">
                                    </div>
                                </div>
                            </div>

                            <!-- Bank Transfer Info -->
                            <div id="bank-info" class="d-none">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Account Number</label>
                                    <input type="text" class="form-control" name="account_number" placeholder="e.g. 1234567890123">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Bank Name</label>
                                    <input type="text" class="form-control" name="bank_name" placeholder="e.g. HBL, UBL">
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success w-100" name="action_type" value="pay">
                                <i class="bi bi-credit-card"></i> Pay Now
                            </button>
                        </div>

                        <!-- Cancel -->
                        <div class="mt-3 text-center">
                            <a href="{% url 'payment_list' %}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> Cancel
                            </a>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Show/Hide logic -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const actionType = document.getElementById("action-type");
    const reserveSection = document.getElementById("reserve-section");
    const paymentSection = document.getElementById("payment-section");
    const methodSelect = document.getElementById("payment-method");
    const cardInfo = document.getElementById("card-info");
    const bankInfo = document.getElementById("bank-info");

    actionType.addEventListener("change", function() {
        reserveSection.classList.add("d-none");
        paymentSection.classList.add("d-none");

        if (this.value === "reserve") {
            reserveSection.classList.remove("d-none");
        } else if (this.value === "pay") {
            paymentSection.classList.remove("d-none");
        }
    });

    methodSelect.addEventListener("change", function() {
        cardInfo.classList.add("d-none");
        bankInfo.classList.add("d-none");

        if (this.value === "card") {
            cardInfo.classList.remove("d-none");
        } else if (this.value === "bank_transfer") {
            bankInfo.classList.remove("d-none");
        }
    });
});
</script>
{% endblock %}
